<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Pareto Frontier Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #f0f2f5;
            margin: 0;
            padding: 2rem;
            color: #333;
        }
        #chart-container {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 1200px;
        }
        h1 {
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        p.subtitle {
            margin-top: 0;
            margin-bottom: 2rem;
            color: #666;
        }
        .tooltip {
            position: absolute;
            text-align: left;
            padding: 10px;
            font-size: 14px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }
        .tooltip strong {
            display: block;
            margin-bottom: 4px;
            font-size: 16px;
        }
        .grid path, .grid line {
            stroke: #e0e0e0;
            stroke-opacity: 0.7;
            shape-rendering: crispEdges;
        }
        .domain {
            stroke: #999;
        }
        .axis-label {
            font-size: 14px;
            fill: #555;
            font-weight: 500;
        }
        .dot {
            stroke-width: 1.5px;
            transition: all 0.2s;
        }
        .node {
            cursor: pointer;
        }
        .label {
            font-size: 9px;
            fill: #333;
            opacity: 0.8;
            pointer-events: none;
        }
        .pareto-line {
            fill: none;
            stroke: #311b92;
            stroke-width: 5px;
            stroke-dasharray: 4 4;
            opacity: 0.5;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        /* Make chart responsive */
        svg {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

<div id="chart-container">
    <h1>LLM Pareto Frontier: Nov 24, 2025</h1>
    <p class="subtitle">Comparing Chatbot Arena Elo scores against API cost ($/1M input tokens). <strong>Price Descending (High Cost on Left).</strong></p>
    <div id="chart-wrapper">
        <svg id="chart"></svg>
    </div>
    <div id="legend" class="legend"></div>
</div>

<script>
    // --- Data Loading and Processing ---
    function setupChart() {
        // Clear previous chart and tooltip to prevent duplicates on resize
        d3.select("#chart").selectAll("*").remove();
        d3.select("body").selectAll(".tooltip").remove();
        d3.select("#legend").selectAll("*").remove();

        // Updated Data: Nov 24, 2025
        const csvData = `Rank,Model,Score,Organization,Input_Price_per_1M_Tokens_USD
1,gemini-3-pro,1495,Google,2.00
2,grok-4.1-thinking,1481,xAI,5.00
3,grok-4.1,1462,xAI,3.50
4,gpt-5.1-high,1463,OpenAI,15.00
5,gemini-2.5-pro,1451,Google,1.25
6,claude-sonnet-4.5-thinking-32k,1449,Anthropic,3.00
7,claude-opus-4.1-thinking-16k,1449,Anthropic,15.00
8,claude-sonnet-4.5,1444,Anthropic,3.00
9,gpt-4.5-preview-2025-02-27,1442,OpenAI,10.00
10,claude-opus-4.1,1440,Anthropic,15.00
11,qwen3-max,1440,Alibaba,1.60
12,gpt-5.1,1439,OpenAI,5.00
13,kimi-k2-thinking,1438,Moonshot,2.00
14,gpt-5-high,1437,OpenAI,15.00
15,ernie-5.0,1436,Baidu,2.00
16,gpt-4o-latest-2025-03-26,1429,OpenAI,2.50
17,deepseek-r1-0528,1426,DeepSeek,0.14
18,grok-3-preview,1423,xAI,3.50
19,deepseek-v3.2-exp,1421,DeepSeek,0.14
20,qwen3-235b-instruct,1418,Alibaba,1.50
21,deepseek-v3.1,1418,DeepSeek,0.14
22,gpt-5-chat,1413,OpenAI,5.00
23,gpt-4.1-2025-04-14,1412,OpenAI,2.00
24,gemini-2.5-flash,1412,Google,0.30
25,mistral-medium-2508,1410,Mistral,0.40
26,glm-4.5,1408,Zhipu,1.50
27,claude-haiku-4.5,1402,Anthropic,1.00
28,mistral-large-2,1389,Mistral,2.00
29,qwen-plus,1370,Alibaba,0.40
30,llama-3.1-405b,1370,Meta,2.00
31,llama-3.1-70b-instruct,1390,Meta,0.60
32,deepseek-v2.5,1379,DeepSeek,0.14
33,claude-3.5-sonnet,1376,Anthropic,3.00
34,gpt-4o-mini,1375,OpenAI,0.15
35,o1-preview,1392,OpenAI,15.00
36,o1-mini,1367,OpenAI,1.10
37,gemini-1.5-pro,1398,Google,1.25
38,gemini-1.5-flash,1383,Google,0.075
39,command-r-plus,1401,Cohere,3.00
40,gemma-3-27b,1402,Google,0.20
41,mistral-large-2402,1377,Mistral,8.00
42,gpt-4-turbo,1409,OpenAI,10.00`;

        const parsedData = d3.csvParse(csvData);

        const llmData = parsedData.map(d => {
            const cost = parseFloat(d.Input_Price_per_1M_Tokens_USD);
            
            if (!isNaN(cost)) {
                return {
                    name: d.Model,
                    elo: +d.Score,
                    cost: cost,
                    family: d.Organization
                };
            }
            return null;
        }).filter(d => d !== null);

        // --- Pareto Frontier Calculation ---
        llmData.sort((a, b) => a.cost - b.cost); // Keep this sort for calculation logic
        const paretoFrontier = [];
        let maxElo = -1;
        for (const model of llmData) {
            if (model.elo > maxElo) {
                paretoFrontier.push(model);
                maxElo = model.elo;
            }
        }
        
        // --- Chart Setup ---
        const container = d3.select("#chart-container");
        const containerWidth = container.node().getBoundingClientRect().width;
        // Adjust height based on width for mobile
        const svgHeight = containerWidth < 600 ? 500 : 600; 
        const margin = { top: 20, right: 40, bottom: 60, left: 60 };
        const width = containerWidth - margin.left - margin.right;
        const height = svgHeight - margin.top - margin.bottom;

        const svg = d3.select("#chart")
            .attr("width", containerWidth)
            .attr("height", svgHeight)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);
        
        // --- Scales ---
        const xMin = d3.min(llmData, d => d.cost) * 0.8;
        const xMax = d3.max(llmData, d => d.cost) * 1.2;
        
        // REVERSED X-AXIS: Range is [width, 0] instead of [0, width]
        const xScale = d3.scaleLog()
            .domain([xMin, xMax]) 
            .range([width, 0]); 

        const yScale = d3.scaleLinear()
            .domain([1350, d3.max(llmData, d => d.elo) + 10]) 
            .range([height, 0]);
        
        // Custom Brand Colors to prevent clashes (specifically xAI vs DeepSeek)
        const brandColors = {
            "xAI": "#1a1a1a",         // Dark Charcoal/Black
            "DeepSeek": "#6f42c1",    // Bright Purple
            "OpenAI": "#10a37f",      // OpenAI Green
            "Google": "#4285F4",      // Google Blue
            "Anthropic": "#d97757",   // Claude Terracotta
            "Meta": "#0668E1",        // Meta Blue
            "Mistral": "#f5a623",     // Mistral Gold
            "Alibaba": "#ff4500",     // OrangeRed
            "Cohere": "#395b64"       // Teal/Slate
        };
        
        const defaultColor = d3.scaleOrdinal(d3.schemeCategory10);

        const getColor = (family) => {
            return brandColors[family] || defaultColor(family);
        };
        
        // --- Axes and Grid ---
        const xAxis = d3.axisBottom(xScale)
            .ticks(5, "$.2f")
            .tickFormat(d => "$" + d);
            
        const yAxis = d3.axisLeft(yScale);

        // Grid lines
        svg.append("g")
            .attr("class", "grid")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale).ticks(5).tickSize(-height).tickFormat(""));

        svg.append("g")
            .attr("class", "grid")
            .call(d3.axisLeft(yScale).tickSize(-width).tickFormat(""));

        // Axis drawing
        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(xAxis)
            .selectAll("text")
            .style("text-anchor", "end")
            .attr("dx", "-.8em")
            .attr("dy", ".15em")
            .attr("transform", "rotate(-45)");
        
        svg.append("g").call(yAxis);

        // Axis Labels
        svg.append("text")
            .attr("class", "axis-label")
            .attr("text-anchor", "middle")
            .attr("x", width / 2)
            .attr("y", height + margin.bottom - 5)
            .text("Price per 1M Input Tokens ($) [Log Scale - Descending]");

        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("text-anchor", "middle")
            .attr("y", -margin.left + 20)
            .attr("x", -height / 2)
            .text("Chatbot Arena Elo Score");

        // --- Tooltip ---
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip");

        // --- Draw Pareto Line ---
        // Sort frontier by Cost Descending (High -> Low) for correct Left -> Right drawing
        const sortedFrontier = [...paretoFrontier].sort((a,b) => b.cost - a.cost);

        const line = d3.line()
            .x(d => xScale(d.cost))
            .y(d => yScale(d.elo))
            // curveStepBefore ensures the line drops vertically immediately when moving right (cheaper),
            // correctly indicating that you lose the higher performance tier as soon as you pay less.
            .curve(d3.curveStepBefore); 

        svg.append("path")
            .datum(sortedFrontier)
            .attr("class", "pareto-line")
            .attr("d", line);

        // --- Draw Dots and Labels ---
        const nodes = svg.selectAll(".node")
            .data(llmData)
            .enter()
            .append("g")
            .attr("class", "node")
            .attr("transform", d => `translate(${xScale(d.cost)}, ${yScale(d.elo)})`);
        
        nodes.append("circle")
            .attr("class", "dot")
            .attr("r", 6)
            .attr("fill", d => getColor(d.family))
            .attr("stroke", "#fff")
            .attr("stroke-width", 1)
            .attr("fill-opacity", 0.8);

        // Only label the very top models or Pareto frontier to avoid clutter
        nodes.filter(d => paretoFrontier.includes(d) || d.elo > 1460)
            .append("text")
            .attr("class", "label")
            .attr("x", 8)
            .attr("y", 3)
            .text(d => d.name);
            
        // Interactive events
        nodes.on("mouseover", function(event, d) {
                d3.select(this).raise().select('circle')
                    .attr('r', 10)
                    .attr("fill-opacity", 1)
                    .attr("stroke", "#333");
                
                tooltip.transition().duration(200).style("opacity", .95);
                tooltip.html(`
                    <strong>${d.name}</strong>
                    <div style="margin-top:4px; color:#555;">
                    Elo: <span style="color:#000; font-weight:600;">${d.elo}</span><br/>
                    Cost: <span style="color:#000; font-weight:600;">$${d.cost.toFixed(2)}</span> / 1M input<br/>
                    Org: ${d.family}
                    </div>
                `)
                    .style("left", (event.pageX + 15) + "px")
                    .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function(d) {
                d3.select(this).select('circle')
                    .attr('r', 6)
                    .attr("fill-opacity", 0.8)
                    .attr("stroke", "#fff");
                tooltip.transition().duration(500).style("opacity", 0);
            });

        // --- Legend ---
        const families = [...new Set(llmData.map(d => d.family))].sort();
        const legend = d3.select("#legend");
        families.forEach(family => {
            const legendItem = legend.append("div")
                .attr("class", "legend-item");
            legendItem.append("div")
                .attr("class", "legend-color")
                .style("background-color", getColor(family));
            legendItem.append("span").text(family);
        });
    }

    // Load the chart
    window.onload = setupChart;
    window.onresize = setupChart;

</script>
</body>
</html>
